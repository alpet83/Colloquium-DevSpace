# Документ дизайна MVP Colloqium DevSpace (Секвестированная версия)

## 1. Введение

**Colloqium DevSpace** — это упрощённая платформа для интерактивной разработки, где разработчики и LLM-агенты (генераторы, тестировщики, критики, оптимизаторы) сотрудничают над кодом через линейный чат. MVP фокусируется на "руках" LLM для автоматизации патчей, тестов и коммитов в изолированной среде. Без фронтенда с мультичатами; чат ведётся в существующем интерфейсе (Grok.com), с MCP как актором через API. Система контейнеризована в Docker Compose для простоты запуска и тестирования Rust-проектов (например, `trade_report`).

**Версия**: MVP 1.0 (Секвестированная, 12 июля 2025 г.)  
**Авторы**: С помощью Grok (xAI), на основе входных данных пользователя.

## 2. Цели и область применения

### Основные цели
1. **Разделение ролей агентов**: LLM-агенты (генератор, тестировщик и т.д.) активируются тегами в чате; MCP как "руки" выполняет действия.
2. **Автоматизированное тестирование**: Патчи и тесты в Docker-песочнице с итерациями (до 3 попыток).
3. **Git-интеграция**: Коммиты от акторов, связанные с чат-сообщениями.
4. **Экология токенов**: Суммирование логов/результатов для избежания перегрузки контекста LLM.
5. **Фокус MVP**: Поддержка Rust-проектов, линейный чат без UI; запуск через Docker Compose для тестов в текущем чате.

### Область применения MVP
- Чат в Grok.com; MCP участвует как третий актор (постит результаты).
- Базовые агенты через xAI API.
- Без мультичатов/UI; без SQL-пропуска (отложено).
- Лимит итераций: 3 на задачу перед эскалацией.
- Тестирование: После запуска Docker — команды в чате (@agent ...).

Вне области MVP: Полный фронтенд, мультичаты, продвинутые агенты, PDF-экспорт.

## 3. Компоненты

Система из двух контейнеров в Docker Compose.

### Основные компоненты
1. **"LLM hands" (Python-модуль)**:
   - **Роль**: Клиент xAI API (с перспективой multi-LLM), мониторит чат, парсит теги, отправляет команды в песочницу.
   - **Функции**: Polling чата, генерация патчей, публикация результатов; интеграция с xAI для постинга в чат.
   - **Технологии**: Python (FastAPI для API, OpenAI SDK для xAI), Requests для polling.

2. **"MCP dev server" (Rust/Python в песочнице)**:
   - **Роль**: Изолированная среда для патчей/тестов; получает REST от "LLM hands".
   - **Функции**: Применение патчей, компиляция (`cargo build`), тесты (`cargo test`), Git-коммиты; итерации на ошибки.
   - **Технологии**: Rust (для совместимости с `trade_report`), Python (GitPython для Git), tempfile для реплик.

3. **Docker Compose**:
   - Контейнер 1: "LLM hands" (Python).
   - Контейнер 2: Песочница (Rust + Python утилиты, на основе твоего Dockerfile).
   - Объёмы: /app/sandwiches (для сэндвичей), /app/trade_report (для проекта).

4. **Git-интеграция**:
   - Temp-репозитории в песочнице; коммиты от акторов.

5. **Логирование**:
   - В стиле `trade_report` (`#INFO`, `#DEBUG`); суммаризация для чата.

### Поток данных
- Чат-сообщение → "LLM hands" парсит тег → REST в песочницу → Обработка (патч/тест) → Summary в чат через xAI.

## 4. Взаимодействие акторов

Акторы: Разработчик (человек), Ассистент (Grok/LLM), MCP (исполнитель).

### Протокол взаимодействия
- **Чат**: Линейный в Grok.com; теги для команд ("@agent [command] #metadata [data]").
- **Итерации**: 3 попытки на ошибку (компиляция/тест), затем эскалация ("@dev escalate: [summary]").
- **Эскалация**: MCP постит в чат; Ассистент анализирует и предлагает Разработчику.

### Пример рабочего процесса
1. **Разработчик**: "@agent code improvement #2025-07-12 file_id=51 [vibe: оптимизировать adjust_to_monday]".
2. **Ассистент**: Генерирует патч: "@agent code improvement #2025-07-12 file_id=51 [патч-код]".
3. **MCP ("LLM hands" + песочница)**: Парсит тег, создаёт реплику, применяет патч.
   - Проверка деградации/компиляции.
   - Если ошибка: 3x фикс, затем эскалация.
   - Успех: Постит полный модуль: "@all Обновлённый /src/tests/task/aggr_trades.rs: [код]".
4. **Разработчик**: "@agent code test #aggr_trades".
5. **MCP**: Запускает тест, итерации, постит суммаризацию.
6. **Разработчик**: "@agent commit [msg: Оптимизирована функция]".
7. **MCP**: Коммит в Git: "От Grok: Оптимизирована функция (chat_id=123)".

### Экология токенов
- MCP суммирует: "Тест провален: 2 ошибки [ключевые строки]".
- Ассистент использует summary для анализа.

## 5. Дорожная карта реализации

Последовательные фазы (оценочно 1 неделя на фазу для MVP).

### Фаза 1: Настройка и "LLM hands" (1 неделя)
- Docker Compose: Python-контейнер для "LLM hands" + песочница (твой Dockerfile).
- Python-модули: xAI-клиент, polling чата, парсинг тегов, REST в песочницу.
- Базовый API в FastAPI: /get_code, /check_degradation, /check_compile, /check_logic, /commit.

### Фаза 2: Песочница и тесты (1 неделя)
- Rust/Python в контейнере: Применение патчей, `cargo build/test`, Git-коммиты.
- Итерации: Цикл (3x) с фиксами через xAI.
- Суммаризация логов: Regex для ошибок.

### Фаза 3: Интеграция и тестирование (0.5 недели)
- Полный запуск: API-ключ в config, тесты в чате.
- Git: Temp-репозитории, коммиты от акторов.

**Зависимости**: xAI API-ключ, репозиторий `trade_report`.

**Риски**: API-лимиты — минимизировать polling (10-30 сек). Нет чата — использовать Grok.com.

